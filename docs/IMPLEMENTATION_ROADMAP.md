# 🎯 実装ロードマップ - 釣り船予約サイト

**作成日**: 2025-10-23  
**ステータス**: 実装待ち  
**目的**: 不足機能を優先度順に実装し、本番運用可能なシステムを構築する

---

## 📋 優先度マトリクス

| 優先度 | 機能 | 工数 | 理由 | ステータス |
|-------|------|------|------|-----------|
| 🔴 **緊急** | 利用規約・プライバシーポリシー | 2h | 法的要件・個人情報保護法対応 | ⏳ 未着手 |
| 🔴 **緊急** | 個人情報同意チェックボックス | 1h | 法的要件 | ⏳ 未着手 |
| 🔴 **緊急** | 管理者ダッシュボード（基本版） | 4h | オーナー監視・課金管理 | ⏳ 未着手 |
| 🔴 **緊急** | オーナー承認制システム | 3h | 品質管理・不正防止 | ⏳ 未着手 |
| 🟠 **高** | メール通知システム | 6h | ユーザー体験の根幹 | ⏳ 未着手 |
| 🟠 **高** | パスワードリセット機能 | 3h | 基本機能 | ⏳ 未着手 |
| 🟠 **高** | データバックアップ自動化 | 2h | データ保護 | ⏳ 未着手 |
| 🟠 **高** | 決済システム（Stripe連携） | 8h | 収益化・ノーショー防止 | ⏳ 未着手 |
| 🟡 **中** | キャンセルポリシー実装 | 4h | トラブル防止 | ⏳ 未着手 |
| 🟡 **中** | マイページ・プロフィール編集 | 3h | UX改善 | ⏳ 未着手 |
| 🟡 **中** | レビュー・評価システム | 6h | 信頼性向上 | ⏳ 未着手 |
| 🟡 **中** | 画像アップロード機能 | 4h | オーナーUX | ⏳ 未着手 |
| 🟡 **中** | リアルタイム在庫管理 | 3h | ダブルブッキング防止 | ⏳ 未着手 |
| 🟢 **低** | カレンダービュー | 4h | UI改善 | ⏳ 未着手 |
| 🟢 **低** | 天気情報連携 | 3h | 便利機能 | ⏳ 未着手 |
| 🟢 **低** | SEO対策 | 4h | 集客改善 | ⏳ 未着手 |
| 🟢 **低** | エラーログ・監視（Sentry） | 2h | 保守性向上 | ⏳ 未着手 |

**合計工数**: 約62時間（約8営業日）

---

## 🚀 フェーズ別実装計画

### **フェーズ1: 法的要件対応（緊急）** 🔴
**目標**: 個人情報保護法に準拠したサイトにする  
**期限**: 即日～1日  
**工数**: 10時間

#### タスク一覧
- [ ] **TASK-001**: 利用規約ページの作成 (`/terms`)
  - 必要条項: サービス内容、禁止事項、免責事項、著作権、準拠法
  - ファイル: `src/app/terms/page.tsx`
  
- [ ] **TASK-002**: プライバシーポリシーページの作成 (`/privacy`)
  - 必要項目: 収集する情報、利用目的、第三者提供、Cookie、問い合わせ先
  - ファイル: `src/app/privacy/page.tsx`
  
- [ ] **TASK-003**: フッターに規約リンク追加
  - 全ページ共通のフッターコンポーネント作成
  - ファイル: `src/components/Footer.tsx`
  
- [ ] **TASK-004**: 個人情報同意チェックボックス追加
  - 対象: 新規登録フォーム (`src/app/register/page.tsx`)
  - 対象: 予約フォーム (`src/app/reserve/page.tsx`)
  - DBに同意日時を記録（`User`モデルに`agreedToTermsAt`追加）
  
- [ ] **TASK-005**: 管理者ダッシュボード基本版
  - `/admin/dashboard` ルート作成
  - オーナー一覧表示
  - 予約統計（総数、売上、直近の予約）
  - ADMIN権限チェックミドルウェア

- [ ] **TASK-006**: オーナー承認制システム
  - `User`モデルに`isApproved`フラグ追加
  - オーナー登録時は`isApproved: false`で仮登録
  - 管理者が承認するまでログイン不可
  - 承認画面: `/admin/owners/pending`

---

### **フェーズ2: 通知・認証機能（高優先）** 🟠
**目標**: ユーザー体験を標準レベルに引き上げる  
**期限**: 2～3日  
**工数**: 13時間

#### タスク一覧
- [ ] **TASK-007**: メール送信基盤構築
  - SendGrid / Resend アカウント作成
  - 環境変数設定 (`SENDGRID_API_KEY`, `FROM_EMAIL`)
  - メール送信ユーティリティ作成 (`src/lib/email.ts`)
  
- [ ] **TASK-008**: 予約完了メール（顧客向け）
  - テンプレート作成
  - API `/api/bookings/route.ts` に送信処理追加
  
- [ ] **TASK-009**: 予約完了メール（オーナー向け）
  - テンプレート作成
  - 同上
  
- [ ] **TASK-010**: 予約キャンセルメール
  - 顧客・オーナー両方に送信
  
- [ ] **TASK-011**: 予約リマインダー（前日通知）
  - Cron Job設定（Vercel Cron / GitHub Actions）
  - `/api/cron/send-reminders` エンドポイント作成
  
- [ ] **TASK-012**: パスワードリセット機能
  - `/forgot-password` ページ作成
  - `/api/auth/forgot-password` エンドポイント
  - トークン生成・有効期限管理
  - `/reset-password?token=xxx` ページ作成
  - `/api/auth/reset-password` エンドポイント
  
- [ ] **TASK-013**: データバックアップ自動化
  - `scripts/backup-db.sh` スクリプト作成
  - `pg_dump` で毎日自動バックアップ
  - さくらVPS cron設定
  - バックアップファイルの世代管理（7日分保持）

---

### **フェーズ3: 決済・キャンセル処理（高優先）** 🟠
**目標**: 収益化とトラブル防止  
**期限**: 4～5日  
**工数**: 12時間

#### タスク一覧
- [ ] **TASK-014**: Stripe連携準備
  - Stripeアカウント作成（テストモード）
  - `@stripe/stripe-js` インストール
  - 環境変数設定 (`STRIPE_SECRET_KEY`, `STRIPE_PUBLISHABLE_KEY`)
  
- [ ] **TASK-015**: 決済フロー実装
  - 予約時に決済ページへ遷移
  - `/api/payment/create-checkout-session` エンドポイント
  - Stripe Checkout統合
  - 決済完了後のWebhook処理 (`/api/webhooks/stripe`)
  
- [ ] **TASK-016**: 予約ステータスの拡張
  - `PENDING` → `PAYMENT_PENDING` → `CONFIRMED`
  - 未払いの予約は1時間後に自動キャンセル
  
- [ ] **TASK-017**: キャンセルポリシー実装
  - `Booking`モデルに`cancellationDeadline`追加
  - キャンセル時の返金額計算ロジック
  - 期限後キャンセルは不可
  
- [ ] **TASK-018**: 返金処理
  - Stripe Refund API連携
  - `/api/bookings/[id]/refund` エンドポイント
  - 管理者・オーナーが返金可能

---

### **フェーズ4: UX改善（中優先）** 🟡
**目標**: 使いやすさと信頼性を向上  
**期限**: 6～8日  
**工数**: 20時間

#### タスク一覧
- [ ] **TASK-019**: マイページ作成
  - `/mypage` ルート
  - プロフィール表示
  - 予約履歴表示
  
- [ ] **TASK-020**: プロフィール編集機能
  - `/mypage/edit` ページ
  - 名前、電話番号、メールアドレス変更
  - `/api/user/profile` エンドポイント
  
- [ ] **TASK-021**: パスワード変更機能
  - `/mypage/change-password` ページ
  - 現在のパスワード確認
  
- [ ] **TASK-022**: アカウント削除機能
  - 確認ダイアログ
  - 予約がある場合は削除不可
  
- [ ] **TASK-023**: レビュー機能（DBスキーマ）
  - `Review` モデル作成
  - `rating: Int (1-5)`, `comment: String`, `bookingId`
  - 乗船済み予約のみレビュー可能
  
- [ ] **TASK-024**: レビュー投稿画面
  - `/bookings/[id]/review` ページ
  - 星評価UI
  
- [ ] **TASK-025**: レビュー表示
  - プラン詳細ページに平均評価表示
  - レビュー一覧表示
  
- [ ] **TASK-026**: 画像アップロード（Cloudinary連携）
  - アカウント作成
  - `next-cloudinary` インストール
  - アップロードウィジェット統合
  - 船舶・プラン画像をURL入力→アップロードに変更
  
- [ ] **TASK-027**: リアルタイム在庫管理
  - トランザクション処理で排他制御
  - 「残り◯席」表示
  - 満席時の予約不可UI

---

### **フェーズ5: 集客・保守（低優先）** 🟢
**目標**: 長期的な運用改善  
**期限**: 必要に応じて  
**工数**: 13時間

#### タスク一覧
- [ ] **TASK-028**: カレンダービューUI
  - `react-calendar` または `react-day-picker` 導入
  - 空き日ハイライト
  - 満席日グレーアウト
  
- [ ] **TASK-029**: 天気情報連携
  - OpenWeatherMap API登録
  - プラン詳細ページに当日天気表示
  - 悪天候アラート
  
- [ ] **TASK-030**: SEO対策
  - 各ページに`metadata`設定
  - OGP画像生成
  - `sitemap.xml`生成
  - `robots.txt`作成
  - 構造化データ（JSON-LD）追加
  
- [ ] **TASK-031**: Sentry導入
  - アカウント作成
  - `@sentry/nextjs` インストール
  - エラートラッキング設定
  
- [ ] **TASK-032**: アクセス解析
  - Vercel Analytics有効化
  - Google Analytics設定

---

## 📊 進捗管理

### 全体進捗
- **完了**: 0/32 タスク (0%)
- **実装中**: 0/32 タスク
- **未着手**: 32/32 タスク

### フェーズ別進捗
| フェーズ | 完了/全体 | 進捗率 |
|---------|-----------|--------|
| フェーズ1（緊急） | 0/6 | 0% |
| フェーズ2（高） | 0/7 | 0% |
| フェーズ3（高） | 0/5 | 0% |
| フェーズ4（中） | 0/9 | 0% |
| フェーズ5（低） | 0/5 | 0% |

---

## 🔧 技術スタック（追加予定）

| カテゴリ | ツール/サービス | 用途 |
|---------|----------------|------|
| メール送信 | SendGrid / Resend | 通知メール |
| 決済 | Stripe | クレジットカード決済 |
| 画像管理 | Cloudinary | 画像アップロード |
| 監視 | Sentry | エラートラッキング |
| 分析 | Vercel Analytics | アクセス解析 |
| 天気API | OpenWeatherMap | 天気情報 |
| Cron | Vercel Cron | 定期実行 |

---

## 📝 更新履歴

| 日付 | 内容 |
|------|------|
| 2025-10-23 | 初版作成 |

---

## 📌 次のアクション

1. **今すぐ**: フェーズ1のTASK-001（利用規約）から着手
2. **今日中**: フェーズ1を完了させる
3. **明日**: フェーズ2のメール通知システム構築開始

**このドキュメントは各タスク完了時に更新してください。**
