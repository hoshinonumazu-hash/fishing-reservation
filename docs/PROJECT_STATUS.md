# プロジェクト状況と今後のタスク

最終更新: 2025-10-16

## 1. 完了済みタスク

### 1.1. プロジェクトの基本設定
- Next.jsとTypeScriptによるプロジェクトの初期構築が完了しています。
- Tailwind CSSでのスタイリング環境構築完了。
- App Router構造に統一済み。

### 1.2. 型定義
- 釣りプランを表す `FishingPlan` 型が `src/types/index.ts` に定義されています。
- Prismaスキーマによる型安全なデータモデルが確立されています。

### 1.3. データベース設計
- PostgreSQL + Prismaによるデータベース環境構築完了。
- User, Boat, FishingPlan, Booking モデルのスキーマ定義完了。
- マイグレーション適用済み。
- DB接続確認エンドポイント (`/api/health/db`) 実装済み。

### 1.4. 認証システム
- **ユーザー登録機能 (POST /api/auth/register)**:
  - email, password, name, phone, role による登録。
  - bcryptによるパスワードハッシュ化。
  - JWT トークン発行。
- **ログイン機能 (POST /api/auth/login)**:
  - email/passwordによる認証。
  - JWT トークン発行。
- **フロントエンド**:
  - `/login` - ログインページ実装済み。
  - `/register` - ユーザー登録ページ実装済み。

### 1.5. APIエンドポイント
- **釣りプラン関連 (GET/POST /api/plans)**:
  - プラン一覧取得API（クエリパラメータによるフィルタリング対応）。
  - プラン作成API（現在はインメモリ・ダミーデータ）。
- **船舶関連 (GET /api/boats)**:
  - 船舶一覧取得API（ダミーデータ）。

### 1.6. フロントエンド実装
- **トップページ (`/`)**:
  - 検索窓UI実装済み。
  - 魚種・エリア・価格フィルタ機能実装済み。
  - プラン一覧表示・カード形式表示実装済み。
  - リアルタイム検索・ローディング表示実装済み。
- **プラン詳細ページ (`/reserve?planId=[id]`)**:
  - プラン詳細情報表示実装済み。
  - 予約フォームは未実装（現在はプレースホルダーのみ）。

---

## 2. 今後のタスク

### 2.1. 最優先タスク

#### **予約機能の実装**
- **予約フォーム実装 (`/reserve`)**:
  - 名前、電話番号などのユーザー情報入力フォーム追加。
  - バリデーション実装（必須項目チェック、電話番号形式など）。
  - 日付・時間選択機能追加。
- **予約API実装 (POST /api/bookings)**:
  - Prismaを使用したBookingモデルへのDB永続化。
  - バリデーション処理。
  - エラーハンドリング強化。
- **予約完了ページ**:
  - 予約完了メッセージ表示。
  - 予約内容の確認表示。

#### **初期データ投入**
- **Seedスクリプト作成**:
  - Boat（船舶）の初期データ作成。
  - FishingPlan（プラン）のテストデータ作成。
  - Userのテストアカウント作成。

### 2.2. 中優先タスク

#### **APIのDB統合**
- **プランAPI改善**:
  - `/api/plans` GET/POST を Prisma使用のDB連携に変更。
  - インメモリデータからDB永続化へ移行。
- **船舶API改善**:
  - `/api/boats` をDB連携に変更。

#### **船舶詳細ページ実装**
- **船舶ページ (`/boats/[boatId]`)**:
  - 船舶情報詳細表示。
  - その船のプラン一覧表示。

#### **船オーナー向け管理機能**
- **プラン管理機能**:
  - プラン作成・編集・削除UI実装。
  - `/boats/my/plans` ページ実装。
  - CRUD API実装（POST/PUT/DELETE /api/plans）。
- **船舶情報編集機能**:
  - `/boats/my/edit` ページ実装。
  - PUT /api/boats API実装。

### 2.3. その他

#### **認証・認可の強化**
- ミドルウェアによる認証チェック実装。
- 船オーナー権限チェック（role: boatOwner のみプラン管理可能）。
- JWT トークン検証ミドルウェア実装。

#### **テストの導入**
- JestやReact Testing Library導入。
- APIエンドポイントの単体テスト作成。
- E2Eテスト（Playwright）導入検討。

#### **デプロイ準備**
- SFTP設定・ファイル転送テスト。
- 本番環境用の環境変数設定。
- SSL証明書設定（Let's Encrypt）。

---

## 3. 提案: 次のステップ

まずは、**予約機能の実装**に着手することを推奨します。

1. **予約フォーム実装**: `/reserve` ページに予約フォームを追加。
2. **予約API実装**: POST /api/bookings でDB保存処理を実装。
3. **初期データ投入**: Seedスクリプトでテストデータを作成し、動作確認を行う。

これらを完成させることで、MVPとしての基本機能が揃います。